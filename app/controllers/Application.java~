package controllers;

import java.sql.Connection;

import play.*;
import play.data.DynamicForm;
import play.data.Form;
import play.db.DB;
import play.mvc.*;
import play.twirl.api.Content;
import views.html.*;
import user.*;
import game.Game;

public class Application extends Controller {
	Game game = new Game();
	Login login = new Login(game.connect);
	User user = new User(game.connect);
	Content html;
	
    public Result index(Boolean loginFailed) {
    	
    	if(loginFailed == null){
    		loginFailed = false;
    	}else if(loginFailed == true){
    		html = views.html.index.render(true);
    	}else{
    		html = views.html.index.render(false);
    	}
    	
        return ok(html);
    }
    
    
    public Result game(){
    	if(login.checkSession(session("connected"))){
    		html = views.html.game.render();
    	}
    	return redirect("/");
    }
    
    public Result loginFailed(){
    	return index(true);
    }
    
    public Result login(){
    	DynamicForm dynamicForm = Form.form().bindFromRequest();
    	int id = login.login(dynamicForm.get("login"), dynamicForm.get("password"));
    	if(id > 0){
    		session("connected",Integer.toString(id));
    		return redirect("/game");
    	}
    	return redirect("/loginFailed");
    }

}
